
<html>
<head>
  <title>Download Prompt</title>
</head>
<body>
  <h2>Download Your File</h2>
  <button id="prompt_download_btn" onclick="downloadPrompt()">Download Prompt</button>
  <h3>download the file then upload the file to <a href="#">chatgpt.com</a> and return to this page. Click 'Enter Categories' to submit the output in this format: ['category 1', 'category 2', ...]</h3>

  <button onclick="enterCategories()">Enter Categories</button>

  <script>
    function downloadPrompt() {
      const urlParams = new URLSearchParams(window.location.search);
      const filePath = urlParams.get('prompt_file_path');
      console.log(`Downloading file: ${filePath}`);

      // Trigger browser to download the file
      window.location.href = `/download?file_path=${encodeURIComponent(filePath)}`;
    }


  // function to enter categories
  function enterCategories() {
      // while (true) {
      const urlParams = new URLSearchParams(window.location.search);
      const filePath = urlParams.get('prompt_file_path');

          const categories = prompt("Enter categories as a python list, e.g., ['cat1', 'cat2', ...]:");
          if (categories) {
              try {
                  // Evaluate the input to convert it into an array
                  const categoriesArray = eval(categories);

                  if (Array.isArray(categoriesArray)) {
                      const p = document.createElement('p');
                      p.innerText = `Categories: ${JSON.stringify(categoriesArray)}`;

                      // send to server
                      fetch('/submit-categories', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ categories: categoriesArray, file: filePath })
                      })

                      
                      .then(res => res.json())
                      .then(data => {
                          if (data.redirect) {
                              console.log("Redirecting to:", data.redirect);
                              window.location.href = data.redirect; // Navigate manually
                          } else {
                              alert(data.message);
                              alert(JSON.stringify(data))
                          }
                      });

                    //   formContainer.appendChild(p);
                      
                      // break; // Exit the loop if input is valid
                  } else {
                      alert("Please enter a valid Python list.");
                  }
              } catch (e) {
                  alert( e + "Error parsing categories. Please ensure it's a valid Python list.");
              }
          }
      // }
  }


  </script>
</body>


</html>
